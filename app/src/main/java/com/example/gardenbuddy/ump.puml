@startuml
skinparam style strict

title GardenBuddy - MVVM UML Diagram

' Organizzazione in package principali
package "data" {

  package "api" {
    class OpenWeatherMapService {
      + getWeatherData(location : String) : WeatherData
    }

    class PlantRecognitionService {
      + recognizePlant(photo : Bitmap) : String
    }

    class PlantInformationService {
          + getInfoByName(name : String) : List<String>
        }
  }

  package "models" {
    class Garden {
      - id : Long
      - name : String
      - latitude : Double
      - longitude : Double
      - dimension : Double
      - photos : List<Bitmap>
      --
      + getId() : String
      + getName() : String
      + getLatitude() : Double
      + getLongitude() : Double
      + getDimension() : Double
      + getPhotos() : List<Bitmap>
      + getPlants() : List<Plant>
    }

    class Plant {
      - plantId : Long
      - scientificName : String
      - species : String
      - family : String
      - parent : String
      - kingdom : String
      --
      + getPlantId() : Long
      + getScientificName() : String
      + getSpecies() : String
      + getFamily() : String
      + getParent() : String
      + getKingdom() : String

    }

    class GardenPlant {
      - photos : List<Bitmap>
      - gardenId : Long
      - plantId : Long
      --
      + getPhotos() : List<String>
      + getPlantId() : Long
      + getGardenId() : Long
    }

    class User {
      - userId : String
      - name : String
      - birthDate : Date
      - email : String
      - weight : Double
      --
      + getUserId() : String
      + getName() : String
      + getBirthDate() : Date
      + getEmail() : String
      + getWeight() : Double
    }


    class WeatherData {
      - temperature : Double
      - humidity : Double
      - windSpeed : Double
      - description : String
      - value : String
      --
      + getTemperature() : Double
      + getHumidity() : Double
      + getWindSpeed() : Double
      + getDescription() : String
      + getValue() : String
    }
  }

  package "repositories" {
    class GardenRepository {

      + loadGarden(gardenId : Long) : Garden
      + saveGarden(garden : Garden) : Garden
      + deleteGarden(gardenId : Long) : String
      + getAllGardens() : List<Garden>
    }

    class WeatherRepository {
      + fetchWeatherData(location : String) : WeatherData
    }

    class PlantRepository {
      + fetchPlantData(photo : Bitmap) : Plant
      + fetchPlantData(name : String) : Plant
    }

    class GardenPlantRepository {
      + loadGardenPlant(PlantId : Long, GardenId : Long) : Pair<Plant, List<Bitmap>>
      + removePlant(plantId : Long, gardenId : Long) : String
      + addPlant(plantId : Long, gardenId : Long, photos : List<Bitmap>) : GardenPlant
      + loadGardenPlants(gardenId : Long) : Result<List<Pair<Plant, List<Bitmap>>>>
      + removeAllPlants(gardenId : Long) : Result<String>
    }

    class AuthRepository {
      + signIn(email : String, password : String)
      + signUp(email : String, password : String, name : String, weight : Double)
      + signOut()
    }
  }
}

package "ui" {
  package "screens" {
    class ActivityBoardScreen {
      + showActivityList()
    }
    class ActivityBoardScreenViewModel {
      + loadActivities()
      + addActivity()
      + removeActivity()
    }

    class GardenScreen {
      + showGarden(gardenId : Long)
    }
    class GardenScreenViewModel {
      + loadGarden(gardenId : Long)
      + saveGarden(garden : Garden)
      + deleteGarden(gardenId : Long)
      + removePlant(plantId : Long)
      + addPlant(plantId : Long, gardenId : Long, photos : List<Bitmap>)
      + loadGardenPlants(gardenId : Long)
    }

    class PlantScreen {
      + showPlant(PlantId : Long)
    }
    class PlantScreenViewModel {
      + loadPlant(PlantId : Long)
      + searchPlant(photo : Bitmap)
      + searchPlant(name : String)
    }

    class GardenPlantScreen {
          + showGardenPlant(PlantId : Long, GardenId : Long)
    }


    class HomeScreen {
      + showHome()
    }
    class HomeScreenViewModel {
      + loadWeatherData(location : String)
      + getUserInfo()
    }

    class UserProfileScreen {
      + showUserProfile(userId : String)
    }
    class UserProfileScreenViewModel {
      + loadUserProfile(userId : String)
      + updateUserInfo(user : User)
    }
  }

  package "theme" {
    ' Eventuali classi o file relativi al tema grafico, color palette, typography, etc.
    class AppTheme {
    }
  }
}

package "utils" {
  class FirebaseInitializer {
    + initFirebase()
  }

  class SensorUtils {
    + startStepCounting()
    + stopStepCounting()
    + getGPSLocation() : Location
  }
}

' MainActivity al di fuori dei package data, ui, utils
class MainActivity {
  + onCreate()
}

' =============================================================================
' RELAZIONI
' =============================================================================

' ------------------ Esempio di relazioni tra ViewModel e Repository ------------------
ActivityBoardScreenViewModel --> GardenRepository : uses
GardenScreenViewModel --> GardenPlantRepository : uses

GardenScreenViewModel --> GardenRepository : uses

HomeScreenViewModel --> WeatherRepository : uses
UserProfileScreenViewModel --> AuthRepository : uses
PlantScreenViewModel --> PlantRepository : uses

' ------------------ Esempio di relazioni tra Repository e Service --------------------
GardenRepository --> FirebaseInitializer : uses (CRUD gardens)
AuthRepository --> FirebaseInitializer : uses (login/registration)
WeatherRepository --> OpenWeatherMapService : uses
PlantRepository --> PlantRecognitionService : uses
PlantRepository --> PlantInformationService : uses

GardenPlantRepository --> PlantRepository : uses

GardenRepository --> PlantInformationService : uses

' ------------------ Esempio di relazioni con SensorUtils (GPS/Accelerometro) ---------
SensorUtils -[hidden]--> HomeScreenViewModel
SensorUtils -[hidden]--> ActivityBoardScreenViewModel
' Se un ViewModel o Repository utilizza direttamente i sensori, puoi rendere visibile la relazione

' ------------------ Esempio di relazioni tra View (Screen) e ViewModel ---------------
ActivityBoardScreen --> ActivityBoardScreenViewModel : observes
GardenScreen --> GardenScreenViewModel : observes
HomeScreen --> HomeScreenViewModel : observes
UserProfileScreen --> UserProfileScreenViewModel : observes
PlantScreen --> PlantScreenViewModel : observes
GardenPlantScreen --> GardenScreenViewModel : observes
' MainActivity come entry point generale (navigator verso le varie screen)
MainActivity --> HomeScreen

@enduml
